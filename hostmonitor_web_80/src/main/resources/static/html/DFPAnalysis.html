<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- JQuery -->
    <script type="text/javascript" src="../JQuery/jquery-3.3.1.min.js"></script>
    <!-- popper 用于下拉框 -->
    <script type="text/javascript" src="../popper/popper.min.js"></script>
    <!-- BootStrap -->
    <link rel="stylesheet" href= "../bootstrap-4.3.1-dist/css/bootstrap.min.css" >
    <script type="text/javascript" src="../bootstrap-4.3.1-dist/js/bootstrap.js"></script>

    <!-- ECharts -->
    <script type="text/javascript" src="../echarts/echarts.min.js"></script>
    <!-- functionLibrary -->
    <script type="text/javascript" src="../js/DataRequest.js"></script>
    <script type="text/javascript" src="../js/WidgetDisplay.js"></script>
    <script type="text/javascript" src="../js/TableAndChart.js"></script>

    <!-- Bootstrap-table -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="../bootstrap-table/bootstrap-table.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="../bootstrap-table/bootstrap-table.min.js"></script>
    <!-- Latest compiled and minified Locales -->
    <script src="../bootstrap-table/bootstrap-table-zh-CN.min.js"></script>
</head>
<body>
    <!--标题-->
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
        <h2 class="h2">当前故障统计</h2>
    </div>

    <div class="row"  style="margin-bottom: 10px;">
        <!--Chart-->
        <div class="col-sm-3">
            <table id="dfpComparison"></table>
        </div>
        <div class="col-sm-3">
            <div id="DFPSummaryChart" style="width: 300px;height: 300px;"></div>
        </div>
        <div class="col-sm-6">
            <div id="FailureTypeStatisticsChart" style="width: 100%;height: 300px;"></div>
        </div>
    </div>


    <!--标题-->
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
        <h2 class="h2">故障趋势</h2>
    </div>

    <div class="row">
        <div id="FailureCountStatisticsChart" style="width: 100%;height: 350px;"></div>
    </div>
</body>

<script>

    //概要Chart
    var DFPSummaryChart = echarts.init(document.getElementById("DFPSummaryChart"));
    var FailureTypeStatisticsChart = echarts.init(document.getElementById("FailureTypeStatisticsChart"));
    var FailureCountStatisticsChart = echarts.init(document.getElementById("FailureCountStatisticsChart"));

    window.onload=function (){
        //刷新SummaryChart
        FSendGetRequest(false,"/Dispersed/getDFPSummaryInfo",function (resultData){
            //-----测速数据
            var resultData = {};
            resultData["dfpComparison"] = [
                {
                    field:"FDR",
                    predict:0.5546,
                    reality:0.6813,
                },
                {
                    field:"FAR",
                    predict:0.782,
                    reality:0.54358,
                },
                {
                    field:"FDR",
                    predict:0.5546,
                    reality:0.6813,
                },
                {
                    field:"FDR",
                    predict:0.5546,
                    reality:0.6813,
                },
                {
                    field:"FDR",
                    predict:0.5546,
                    reality:0.6813,
                },
            ];
            resultData["diskType"] = ["类型1","类型2","类型3","类型4","类型5"];
            resultData["hddCount"] = [0,2,8,6,3];
            resultData["ssdCount"] = [6,2,8,3,7];
            resultData["trend"] = [];
            resultData["SummaryChart"] = [1,2,3];
            var dataLength = 100;
            var timestamp=new Date().getTime();
            for(var i=0;i<dataLength;i++){
                var currentDate = timestamp - (dataLength-i)*120000;
                resultData["trend"].push([currentDate,Math.ceil(Math.random()*10)]);
            }

            //预期与实际对比
            $('#dfpComparison').bootstrapTable({
                columns: tableColumns["dfpComparison"],
                data: resultData["dfpComparison"],
            });
            //故障类型统计
            FailureTypeStatisticsChart.setOption(FGetFailureTypeStatisticsChartOption(resultData["diskType"],resultData["hddCount"],resultData["ssdCount"]));
            //趋势统计
            FailureCountStatisticsChart.setOption(FGetFailureCountStatisticsChartOption(resultData["trend"]));


            //故障预测统计
            var option = FGetDFPSummaryChartOption();
            var percentage = [];
            var sum = 0;
            for(var i=0;i<resultData["SummaryChart"].length;i++){
                sum += resultData["SummaryChart"][i];
            }
            for(var i=0;i<3;i++){
                percentage.push( (resultData["SummaryChart"][i]/sum* 100).toFixed(1) ) ;
            }
            for(var i=0;i<3;i++){
                option["series"][0]["data"][i]["value"] = percentage[i];
                option["series"][1]["data"][i]["value"] = resultData["SummaryChart"][i];
            }
            DFPSummaryChart.setOption(option);
        });

    }
</script>
</html>