<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- JQuery -->
    <script type="text/javascript" src="../JQuery/jquery-3.3.1.min.js"></script>
    <!-- popper 用于下拉框 -->
    <script type="text/javascript" src="../popper/popper.min.js"></script>
    <!-- BootStrap -->
    <link rel="stylesheet" href= "../bootstrap-4.3.1-dist/css/bootstrap.min.css" >
    <script type="text/javascript" src="../bootstrap-4.3.1-dist/js/bootstrap.js"></script>

    <!-- ECharts -->
    <script type="text/javascript" src="../echarts/echarts.min.js"></script>
    <!-- functionLibrary -->
    <script type="text/javascript" src="../js/DataRequest.js"></script>
    <script type="text/javascript" src="../js/WidgetDisplay.js"></script>
    <script type="text/javascript" src="../js/TableAndChart.js"></script>

    <!-- Bootstrap-table -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="../bootstrap-table/bootstrap-table.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="../bootstrap-table/bootstrap-table.min.js"></script>
    <!-- Latest compiled and minified Locales -->
    <script src="../bootstrap-table/bootstrap-table-zh-CN.min.js"></script>
</head>
<body>
    <!--标题-->
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
        <h2 class="h2">系统概况</h2>
    </div>
    <!--摘要部分-->
    <div style="margin-bottom: 10px;">
        <table id="summaryPart" data-show-header="false"></table>
    </div>

    <div class="row"  style="margin-bottom: 10px;">
        <!--摘要Chart-->
        <div id="SummaryChart" style="width: 100%;height: 300px;"></div>
    </div>

    <!--标题-->
<!--    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">-->
<!--        <h2 class="h2">节点状态</h2>-->
<!--    </div>-->
    <!--主机状态Table-->
<!--    <table id="hostInfo1Table" style="table-layout: fixed;word-break: break-all"></table>-->

    <div style="height: 100px;width: 100%"></div>
</body>

<script>
    //摘要Chart
    var SummaryChart = echarts.init(document.getElementById("SummaryChart"));
    //状态Table
    var hostInfo1Table = document.getElementById("hostInfo1Table");
    //Host名
    var hostIpList = [];
    //加载后执行
    window.onload=function (){
        //初始化SummaryChart
        SummaryChart.setOption(FGetSummaryChartOption());
        refreshSummary(true);

        //-----更新HostInfo数据.
        FRefreshDataHostInfoAll(function (){
            //refreshHostInfoAndDiskInfoTable(true);
        })
        setInterval(function (){
            FRefreshDataSummary(function (){
                refreshSummary(false);
            });
            FRefreshDataHostInfoAll(function (){
                //refreshHostInfoAndDiskInfoTable(false);
            });

        },20000);
    }

    function refreshSummary(init){
        //MainInfo
        var mainInfo = FGetMainInfo();
        //Host名
        hostIpList = mainInfo["hostIp"];
        //刷新SummaryTable
        refreshSummaryTable(init,mainInfo);
        //刷新SummaryChart
        setTimeout(function(){
            FRefreshSummaryChartData(SummaryChart,mainInfo["summaryChart"]);
        }, 1000);
    }


    //刷新Table-SummaryTable
    function refreshSummaryTable(init,mainInfo){
        if(init){
            $('#summaryPart').bootstrapTable({
                columns: tableColumns["summaryPart"],
                data: mainInfo["summaryPart"],
                classes : 'table table-bordered'
            });
        }
        else{
            $('#summaryPart').bootstrapTable("load",mainInfo["summaryPart"]);
        }

    }

    //刷新Table-HostInfo-DiskInfo-All
    function refreshHostInfoAndDiskInfoTable(init){
        var dataList = [];
        for(var i=0;i<hostIpList.length;i++){
            var hostInfo = FGetHostInfo(hostIpList[i]);
            dataList.push(hostInfo["hostInfo1"]);
        }
        if(init){
            $("#hostInfo1Table").bootstrapTable({
                columns: tableColumns["hostInfo1"],
                data: dataList,
            });
        }
        else{
            $('#hostInfo1Table').bootstrapTable("load",dataList);
        }

    }
</script>

</html>